/*! fastspring-builder 0.7.4 */

!function(){"use strict";function a(a){if(void 0===a||null===a)return!0;for(var b in a)if(a.hasOwnProperty(b))return!1;return JSON.stringify(a)===JSON.stringify({})}function b(a){if(g.debug||d.storage.getItem("debug")){var b=Array.prototype.slice.call(arguments);"string"==typeof a&&b.unshift("[FastSpring API] "+b.shift()),console.log.apply(console,b)}}function c(a){var b=Array.prototype.slice.call(arguments);"string"==typeof a&&b.unshift("[FastSpring API] "+b.shift()),(console.error||console.log).apply(console,b)}var d={merge:function(a,b){for(var c in b)if(b.hasOwnProperty(c))try{"products"===c?(a.products=a.products||[],a.products=a.products.concat(b.products)):"object"==typeof a[c]?a[c]=d.merge(a[c],b[c]):a[c]=b[c]}catch(d){a[c]=b[c]}return a},returnMeaningful:function(a){a.reverse();var b={},c=[];return a.forEach(function(a){b.hasOwnProperty(a.path)||(b[a.path]=!0,c.push(a))}),c},runCallback:function(a,b){"function"==typeof a&&a.apply(null,b)}},e=!0;try{window.localStorage.setItem("fs","fs"),window.localStorage.removeItem("fs")}catch(a){e=!1}Object.defineProperty(d,"storage",{get:function a(){return e&&"localStorage"in window?window.localStorage:(void 0===a.storage&&(a.storage={_data:{},setItem:function(a,b){return this._data[a]=String(b)},getItem:function(a){return this._data.hasOwnProperty(a)?this._data[a]:void 0},removeItem:function(a){return delete this._data[a]},clear:function(){return this._data={}}}),a.storage)}});var f={attach:function(){this.spinSVG.style.position="absolute",this.spinSVG.style.top="50%",this.spinSVG.style.marginTop="-50px",this.spinSVG.style.left="50%",this.spinSVG.style.marginLeft="-50px",this.spinSVG.style.zIndex="100000000000000",this.spinSVG.style.display="block",h.canvas.appendChild(this.spinSVG)},remove:function(){void 0!==this.spinSVG&&(this.spinSVG.style.display="none")}},g={assignAttributeValues:function(a){this.animateFader=a.getAttribute("data-animate-fader")||"true",this.beforeRequests=a.getAttribute("data-before-requests-callback"),this.afterRequests=a.getAttribute("data-after-requests-callback"),this.beforeMarkup=a.getAttribute("data-before-markup-callback"),this.afterMarkup=a.getAttribute("data-after-markup-callback"),this.decorateCallback=a.getAttribute("data-decorate-callback"),this.dataCallback=a.getAttribute("data-data-callback"),this.errorCallback=a.getAttribute("data-error-callback"),this.markupHelpers=a.getAttribute("data-markup-helpers-callback"),this.popupClosed=a.getAttribute("data-popup-closed"),this.popupWebhookReceived=a.getAttribute("data-popup-webhook-received"),this.popupEventReceived=a.getAttribute("data-popup-event-received"),this.storefront=a.getAttribute("data-storefront"),this.debug="true"===a.getAttribute("data-debug"),this.aKey=a.getAttribute("data-access-key"),this.continuous="true"===a.getAttribute("data-continuous"),this.sblVersion=a.getAttribute("src")},init:function(){this.assignAttributeValues(k),this.checkoutMode="redirect",null===this.storefront.match(/pinhole/)&&null===this.storefront.match(/popup/)||(this.checkoutMode="popup"),null!==this.storefront.match(/inapp/)&&(this.checkoutMode="inapp"),b("Checkout mode:",this.checkoutMode),this.testMode=!1,/\.test\./.test(this.storefront)?this.testMode=!0:/(localhost:[^?]*\*)/.test(this.storefront)&&(this.testMode=!0),b("Test mode:",this.testMode),null!==this.aKey&&b("Access key:",this.aKey),"popup"===this.checkoutMode&&(f.spinSVG=document.createElement("img"),f.spinSVG.src="https://d1f8f9xcsvx3ha.cloudfront.net/pinhole/spin.svg"),this.sessionID=null,this.data={},this.finishSilently=!1,this.builder="/builder",this.requests=[],"inapp"!==this.checkoutMode&&h.checkURL(),this.parseInput(l),m=!0},continuousGet:function(){b(" -> Checking for existing session");var a=null,c=d.storage.getItem("fscSerial-"+this.storefront);if(c&&(c=JSON.parse(c),c.hasOwnProperty("session")&&c.hasOwnProperty("expires"))){var e=(new Date).getTime();c.expires>e?(a=c.session,b(" (+) Serial is still valid")):b(" (-) Serial is expired")}return a},continuousStore:function(a){b(" <- Writing to storage:",a),d.storage.setItem("fscSerial-"+this.storefront,JSON.stringify(a))},continuousReset:function(){b(" <- Resetting session"),d.storage.removeItem("fscSerial-"+this.storefront),this.sessionID=null},parseInput:function(a,e){var f=this.sanitizeInput(a);if(b("Input: ",a,"Sanitized output:",f),a.hasOwnProperty("secure")&&(null===this.aKey?c("No access key found in payload"):a.secure.hasOwnProperty("payload")?this.testMode?a.secure.hasOwnProperty("key")?(f.accessKey=this.aKey,f.secureKey=a.secure.key,f.securePayload=a.secure.payload):(f.accessKey=this.aKey,d.merge(f,a.secure.payload)):a.secure.hasOwnProperty("key")?(f.accessKey=this.aKey,f.secureKey=a.secure.key,f.securePayload=a.secure.payload):c("No secure key found in payload"):c("No secure payload found in request")),a.hasOwnProperty("authenticate")){if(b("Found authentication payload",a.authenticate),null===this.aKey)return b("No access key found while authenticating user"),void d.runCallback(e);a.authenticate.hasOwnProperty("key")?this.authenticateUser(a.authenticate.payload,a.authenticate.key):this.authenticateUser(a.authenticate.payload)}if(a.hasOwnProperty("reset")&&this.continuousReset(),a.hasOwnProperty("clean")&&(o=!0),a.hasOwnProperty("session")?(this.sessionID=a.session,b("Session found in input:",this.sessionID)):this.continuous&&!this.sessionID&&(this.sessionID=this.continuousGet(),b("Continuous mode session:",this.sessionID)),a.hasOwnProperty("checkout"))if("popup"===g.checkoutMode&&h.drawCanvas(),"true"!==a.checkout&&"false"!==a.checkout&&a.checkout.length>10){d.storage.setItem("fscLatestSession-"+this.storefront,a.checkout);var i="https://"+this.storefront+"/session/"+a.checkout;g.continueCheckoutWithURL(i,e)}else g.checkoutRedirect(f,e);else a.hasOwnProperty("authenticate")||this.loadProducts(f,e);this.flushChain(),l={}},chain:function(a){b(" >> Chaining request:",a),this.requests.push(a)},flushChain:function(){if(b("Is requests chain locked?",g.ajaxInProgress),!g.ajaxInProgress){if("function"==typeof window[this.beforeRequests]){b(" <- Calling ",this.beforeRequests);try{window[this.beforeRequests].call(null)}catch(a){c("Error in before-requests",a)}}b("Preparing to make requests:",JSON.stringify(this.requests)),this.nextRequest()}},nextRequest:function(){var a;if(void 0!==this.requests[0])a=this.requests.shift(),this.request(a.endpoint,a.method,a.payload,a.hasOwnProperty("skipsession"),a.callback);else if(b("Unlocking request chain"),g.ajaxInProgress=!1,"function"==typeof window[this.afterRequests]){b(" <- Calling ",this.afterRequests);try{window[this.afterRequests]()}catch(a){c("Error in data-after-requests-callback",a)}}},uninstall:function(){this.requests.splice(0,this.requests.length)},handleData:function(a,e){if(a=this.sanitize(a),void 0!==this.requests[0])return b("Running next request"),void d.runCallback(e,[a]);if(this.finishSilently)return b("Finishing silently and returning no data"),void d.runCallback(e,[a]);if("function"==typeof window[this.dataCallback]){b("<- Calling ",this.dataCallback);try{window[this.dataCallback](a)}catch(a){c("Error in data-callback",a)}}j.setData(a),d.runCallback(e,[a]),j.process(),this.data={}},handleSerial:function(a,c){if(this.sessionID!==a)return this.sessionID=a,this.continuous&&(b("Storing session ID for continuity"),this.continuousStore({session:this.sessionID,expires:c})),b("New session ID:",this.sessionID),this.sessionID},sanitize:function(a){return delete a.serial,delete a.expires,g.groupsByProduct={},a.groups.forEach(function(a){a.selectables=!1,a.selectableReplacements=!1,a.selectableAdditions=!1,a.items.forEach(function(b){b.selectables=!1,b.selectableReplacements=!1,b.selectableAdditions=!1,b.selected||(a.selectables=!0,"add"===a.type&&(a.selectableAdditions=!0),"replace"===a.type&&(a.selectableReplacements=!0)),g.groupsByProduct[b.path]=this.driver,b.groups.forEach(function(a){a.items.forEach(function(b){b.selected||(a.selectables=!0,b.selectables=!0,"replace"===a.type&&(a.selectableReplacements=!0))},a),!0===a.selectables&&(b.selectables=!0),!0===a.selectableReplacements&&(b.selectableReplacements=!0),"options"===a.type&&(g.newGroupItemsNamed={},g.newGroupItems=[],a.items.forEach(function(a){g.newGroupItemsNamed[a.path]=a}),g.newGroupItemsNamed[this.path]=this,a.ordering.forEach(function(a){g.newGroupItems.push(g.newGroupItemsNamed[a])}),a.items=g.newGroupItems,g.newGroupItemsNamed={},g.newGroupItems=[])},b)},a)}),a.groups.forEach(function(a){a.driverType="storefront","add"===a.type&&g.groupsByProduct.hasOwnProperty(a.driver)&&(a.driverType="product",a.driverOrigin=g.groupsByProduct[a.driver])}),g.groupsByProduct={},a},sanitizeInput:function(a){var b={};return a.hasOwnProperty("coupon")&&(b.coupon=a.coupon),a.hasOwnProperty("products")&&a.products.length>0&&(b.items=d.returnMeaningful(a.products)),a.hasOwnProperty("tags")&&(b.tags=a.tags),a.hasOwnProperty("paymentContact")&&(b.paymentContact=a.paymentContact),a.hasOwnProperty("country")&&(b.country=a.country),a.hasOwnProperty("language")&&(b.language=a.language),b},authenticateUser:function(a,c){var d,e;if(b("Authenticating user"),this.testMode)d=a,d.accessKey=this.aKey;else{if(!c)return void b("No secure key found while authenticating user");d={securePayload:a,accessKey:this.aKey,secureKey:c}}e="https://"+g.storefront+"/account/authenticate",d={data:JSON.stringify(d)},this.chain({endpoint:e,method:"POST",payload:d,skipsession:!0})},loadProducts:function(c,d){var e,f;b(" + Getting products"),f="https://"+g.storefront+g.builder;var h="POST";if(a(c))e={},this.sessionID||(h="GET");else{var i=null;if(-1!=this.sblVersion.indexOf("sbl")){var j=this.sblVersion.substring(this.sblVersion.indexOf("sbl"));i=j.substring(j.indexOf("/")+1,j.lastIndexOf("/"))}c.sblVersion=i,e={put:JSON.stringify(c)}}this.chain({endpoint:f,method:h,payload:e,callback:d})},checkoutRedirect:function(a,c){var d,e;if(b(" + Redirecting to checkout"),e="https://"+g.storefront+g.builder+"/finalize","popup"!==g.checkoutMode&&"inapp"!==g.checkoutMode||(a.origin=document.location.href),a){var f=null;if(-1!=this.sblVersion.indexOf("sbl")){var h=this.sblVersion.substring(this.sblVersion.indexOf("sbl"));f=h.substring(h.indexOf("/")+1,h.lastIndexOf("/"))}a.sblVersion=f,d={put:JSON.stringify(a)}}else d={};this.chain({endpoint:e,method:"POST",payload:d,callback:c})},request:function(a,e,f,i,j){b("Locking requests chain"),g.ajaxInProgress=!0,this.sessionID&&!i&&(f.session=this.sessionID);var k=this.toQueryString(f);b(" > > > Making request to "+a+" ("+e+") with data:",k);try{var l=new XMLHttpRequest;l.open(e,a,!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),l.onerror=function(){c("(!) Error received: ",l.status,l.responseText),g.runErrorCallback(l.status,l.responseText),d.runCallback(j,[!1]),g.nextRequest()},l.onreadystatechange=function(){4===l.readyState&&(l.status>=200&&l.status<400?g.successHandler(l,j):(c("(!) Error: Error received: ",l.status,l.responseText),"popup"===g.checkoutMode&&h.destroy(),g.runErrorCallback(l.status,l.responseText),d.runCallback(j,[!1]),g.nextRequest()))},l.send(k)}catch(a){c("Exception: ",a)}},runErrorCallback:function(a,d){if("function"==typeof window[g.errorCallback]){b(" <- Calling ",g.errorCallback);try{window[g.errorCallback](a,d)}catch(a){c("Error in error-callback",a)}}},successHandler:function(a,c){var e;try{e=JSON.parse(a.responseText)}catch(b){return g.runErrorCallback(a.status,a.responseText),d.runCallback(c,[!1,a&&a.responseText])}if(b("Request is OK, returned data: ",e),e.hasOwnProperty("url")&&!e.hasOwnProperty("serial")){d.runCallback(c,[e]),g.nextRequest(),b("Obtained redirection parameter",e.url);var f=e.url;return e.hasOwnProperty("session")&&d.storage.setItem("fscLatestSession-"+g.storefront,e.session),void g.continueCheckoutWithURL(f)}this.handleSerial(e.serial,e.expires),this.handleData(e,c),this.nextRequest()},toQueryString:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+"="+encodeURIComponent(a[c]));return b.join("&")},continueCheckoutWithURL:function(a,e){if("function"==typeof window[g.decorateCallback]){b(" <- Calling ",g.decorateCallback);var f=window[g.decorateCallback](a);try{f&&f.length>0&&f.indexOf(a)>-1?a=f:c("data-decorate-callback Must return correct url")}catch(a){c(a)}}"popup"===g.checkoutMode&&/\/popup-/.test(a)?(!0===o&&g.continuousReset(),h.drawFrame(a)):(!0===o&&g.continuousReset(),window.location=a),d.runCallback(e)}},h={iframeId:"fsc-popup-frame",checkURL:function(){var a,b,c=/fsc:invoke:(session|complete)/g.exec(decodeURIComponent(document.location.search));if(c&&c.length>0&&("session"===c[1]||"complete"===c[1])&&(b=localStorage.getItem("fscLatestSession-"+g.storefront))){a="complete"===c[1]?b+"/complete":b;var d=setInterval(function(){"complete"===document.readyState&&(clearInterval(d),window.addEventListener("message",h.listener,!1),h.drawCanvas(),h.drawFrame("https://"+g.storefront+"/session/"+a))},100)}},listener:function(a){if(a.data.hasOwnProperty("fscPopupMessage")&&a.data.fscPopupMessage.hasOwnProperty("action")){var b=a.data.fscPopupMessage;"close"===b.action?(b.hasOwnProperty("orderReferences")?h.popupClosedFunction(b.orderReferences):h.popupClosedFunction(null),h.frame.close&&h.frame.close()):"event"===b.action&&b.hasOwnProperty("eventData")?h.publishEvent(b.eventData):"hook"===b.action&&b.hasOwnProperty("hookData")?h.hookEvent(b.hookData):"scroll"===b.action&&(document.body.scrollTop=0)}},popupClosedFunction:function(a){if("function"==typeof window[g.popupClosed]){b("Calling data-popup-closed callback");try{window[g.popupClosed](a)}catch(a){c("Error in data-popup-closed callback",a)}}a&&localStorage.removeItem("fscLatestSession-"+g.storefront),b("Popup Closed. Is there an order number?",a),h.destroy()},publishEvent:function(a){if(b("Event published",a),"function"==typeof window[g.popupEventReceived]){b(" <- Calling ",g.popupEventReceived);try{window[g.popupEventReceived](a)}catch(a){b(" -- Error in popup-event-received")}}},hookEvent:function(a){if(b("Hook published: ",a),"function"==typeof window[g.popupWebhookReceived]){b(" <- Calling ",g.popupWebhookReceived);try{window[g.popupWebhookReceived](a)}catch(a){b(" --Error in popup-webhook-received")}}},drawCanvas:function(){window.addEventListener("message",h.listener,!1),/iPhone|iPad|iPod/i.test(navigator.userAgent)&&(this.frame=window.open()),document.getElementById("fscCanvas")||(this.canvas=document.createElement("div"),this.canvas.id="fscCanvas",this.canvas.setAttribute("style","background: -webkit-linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.8)); background: -o-linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.8)); background: -moz-linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.8)); background: linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.8));"),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="fixed",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.zIndex="100000000000000",g.animateFader&&(this.canvas.style.transitionProperty="opacity",this.canvas.style.transitionDuration="0.5s",this.canvas.style.opacity="0"),document.body.appendChild(this.canvas),g.animateFader&&setTimeout(function(){document.getElementById("fscCanvas").style.opacity="1"},100)),f.attach()},drawFrame:function(a){b("Launching popup with URL",a),this.frame?(f.remove(),this.canvas.remove(),this.frame.location=a):document.getElementById(h.iframeId)?a.length>0&&(this.frame.location=a):(this.frame=document.createElement("iframe"),this.frame.id=h.iframeId,this.frame.setAttribute("name",h.iframeId),this.frame.width="100%",this.frame.height="100%",/iPhone|iPad|iPod/i.test(navigator.userAgent)?(this.frame.style.position="absolute",document.body.scrollTop=0):this.frame.style.position="fixed",this.frame.style.top="0",this.frame.style.left="0",this.frame.style.background="transparent",this.frame.style.zIndex="1000000000000000",this.frame.frameBorder=0,this.frame.setAttribute("background","transparent"),a.length>0&&this.frame.setAttribute("src",a),document.body.appendChild(this.frame),document.body.setAttribute("data-overflow",document.body.style.overflow),document.body.style.overflow="hidden",this.frame.onload=function(){f.remove()})},destroy:function(){if(document.body.style.overflow=document.body.getAttribute("data-overflow"),document.body.removeAttribute("data-overflow"),f.remove(),window.removeEventListener("message",h.listener,!1),this.blur&&(this.blur.parentNode.removeChild(this.blur),this.blur=null),h.canvas){var a=0;g.animateFader&&(h.canvas.style.opacity="0",a=500),setTimeout(function(){h.frame&&h.frame.parentNode&&(h.frame.parentNode.removeChild(h.frame),h.frame=null),h.canvas&&h.canvas.parentNode&&(h.canvas.parentNode.removeChild(h.canvas),h.canvas=null)},a)}}},i={push:function(a,c){!m||n?(l=d.merge(l,a),c&&b("Unexpected callback sent to push")):g.parseInput(a,c)},checkout:function(a,b){a&&a.length>10?i.push({checkout:a},b):i.push({checkout:!0},b)},promo:function(a,b){i.push({coupon:a},b)},update:function(a,b,c){i.push({products:[{path:a,quantity:parseInt(b,10)}]},c)},remove:function(a,b){i.push({products:[{path:a,quantity:0}]},b)},add:function(a,b){i.update(a,1,b)},recognize:function(){if(arguments.length>0){var a="function"==typeof arguments[arguments.length-1]&&arguments[arguments.length].pop(),b=["firstName","lastName","email","company","addressLine1","addressLine2","city","region","country","postalCode","phoneNumber"],c=arguments[0];"object"!=typeof c&&(c={},c.email=arguments[0],c.firstName=arguments.length>0&&arguments[1],c.lastName=arguments.length>1&&arguments[2]);var d={paymentContact:{}};for(var e in c)c.hasOwnProperty(e)&&~b.indexOf(e)&&(d.paymentContact[e]=c[e]);i.push(d,a)}},reset:function(a){i.push({reset:!0},a)},clean:function(a){i.push({clean:!0},a)},secure:function(a,b,c){var d={secure:{payload:a}};b&&(d.secure.key=b),i.push(d,c)},authenticate:function(a,b,c){var d={authenticate:{payload:a}};b&&(d.authenticate.key=b),i.push(d,c)},tag:function(a,b,c){var d={tags:{}};if("object"==typeof a)for(var e in a)a.hasOwnProperty(e)&&(d.tags[e]=a[e]);else d.tags[a]=b;i.push(d,c)},country:function(a,b){i.push({country:a},b)},language:function(a,b){i.push({language:a},b)},_uninstall:function(){g.uninstall(),j.uninstall(),h.destroy();var a=document.querySelector("script#fsc-api");a.parentNode.removeChild(a),delete window._f,delete window.fastspring},Recompile:function(a,b,c){j.compileHandlebarsTemplate(a,b,c)}};["Add","Push","Authenticate","Checkout","Clean","Country","Language","Tag","Secure","Remove","Promo","Update","Recognize","Reset"].forEach(function(a){var b=a.toLowerCase();Object.defineProperty(i,a,{enumerable:!1,get:function(){return console.log("Warning: '"+a+"' is deprecated, please use '"+b+"' instead"),i[b]}})});var j={init:function(){if(this.isDynaCart=!1,this.ready=!0,this.listDriver=k.getAttribute("data-storefront").split(".")[0],this.$fscDynaContainers=document.querySelectorAll("[data-fsc-items-container]"),this.dynaListObjs=[],void 0!==this.$fscDynaContainers[0]){this.isDynaCart=!0;for(var a="",b="",c=this.$fscDynaContainers.length,d=0;d<c;d++)b=this.$fscDynaContainers[d].getAttribute("data-fsc-items-container"),a=this.$fscDynaContainers[d].getAttribute("data-fsc-filter"),this.dynaListObjs.push({containerName:b,filterList:a})}},setData:function(a){b("Received data for Markup:",a),this.data=a},loadHandlebarsLib:function(a,b,d){function e(a,b,c){if(c&&!document.getElementById(a)){var d=document.getElementsByTagName("head").item(0),e=document.createElement("script");e.language="javascript",e.type="text/javascript",e.id=a,e.defer=!0,e.text=c,d.appendChild(e)}}if(window.Handlebars)d();else{var f=new XMLHttpRequest;f.open("GET",b,!0),f.send(),f.onreadystatechange=function(){4===f.readyState&&(200===f.status||304===f.status?e(a,b,f.responseText):c("XML request error: "+f.statusText+" ("+f.status+")"),d())}}},compileHandlebarsTemplate:function(a,b){if("object"==typeof b){var c=[];for(var d in b)b.hasOwnProperty(d)&&c.push(d+"='"+b[d]+"'");b=c.join(";")}for(var e,f=0;f<this.dynaListObjs.length;f++)if(this.dynaListObjs[f].containerName===a){if(null==(e=document.querySelector("[data-fsc-template-for='"+a+"']")))return;this.dynaListObjs[f].filterList=b,this.handlebarTemplates[f]=Handlebars.compile(e.innerHTML),this.parseAndPut(this.data),this.afterMarkup();break}},process:function(){if(!0===this.ready&&this.data){if(this.data.groups.forEach(function(a){a.items.forEach(function(a){a.hasOwnProperty("description")&&a.description.hasOwnProperty("action")&&(a.description.action=a.description.action.replace("<p>","").replace("</p>",""))})}),"function"==typeof window[g.beforeMarkup]){b(" <- Calling ",g.beforeMarkup);try{window[g.beforeMarkup]()}catch(a){c(" --Error in data-before-markup-callback")}}b("Doing markup with data:",this.data),this.isDynaCart?this.loadHandlebarsLib("handlebarScriptElm","https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.1/handlebars.min.js",function(){if("function"==typeof window[g.markupHelpers]){b(" <- Calling ",g.markupHelpers);try{window[g.markupHelpers]()}catch(a){c(" --Error in data-after-markup-callback",a)}}this.handlebarTemplates=[];for(var a=0;a<this.dynaListObjs.length;a++){var d=document.querySelector("[data-fsc-template-for='"+this.dynaListObjs[a].containerName+"']");null!==d&&(this.handlebarTemplates[a]=Handlebars.compile(d.innerHTML))}this.parseAndPut(this.data),this.afterMarkup()}.bind(this)):(this.parseAndPut(this.data),this.afterMarkup())}},afterMarkup:function(){if("function"==typeof window[g.afterMarkup]){b(" <- Calling ",g.afterMarkup);try{window[g.afterMarkup]()}catch(a){c(" --Error in data-after-markup-callback",a)}}},addEventHandlers:function(){this.functions={},this.functions.preventDefault=function(a){a.preventDefault()},this.functions.Add=function(a){j.Add(a)},this.functions.Update=function(a){j.Update(a)},this.functions.Remove=function(a){j.Remove(a)},this.functions.Promocode=function(a){j.Promo(a)},this.functions.Recognize=function(a){j.Recognize(a)},this.functions.Reset=function(a){j.Reset(a)},this.functions.Clean=function(a){j.Clean(a)},this.functions.Checkout=function(a){j.Checkout(a)},this.functions.autoUpdate=function(){setTimeout(function(){j.Update(this)}.bind(this),1500)},this.functions.Replace=function(a){j.Add(a)},this.functions.Multiple=function(){j.Multiple(this)},this.unbinders=[];for(var a=document.querySelectorAll("[data-fsc-action=Add],[data-fsc-action=Update],[data-fsc-action=Remove], [data-fsc-action=Replace],[data-fsc-action=Promocode],[data-fsc-action=Reset],[data-fsc-action=Recognize],[data-fsc-action*=','],[data-fsc-action=Checkout]"),b=0;b<a.length;b++){var c=a[b].cloneNode(!0),d=c.tagName.toLowerCase(),e=["checkbox","radio","search","text"];"a"===d?c.addEventListener?(c.addEventListener("click",this.functions.Multiple,!1),c.addEventListener("click",this.functions.preventDefault,!1),this.unbinders.push({element:c,action:"click",fn:this.functions.Multiple}),this.unbinders.push({element:c,action:"click",fn:this.functions.preventDefault})):(c.attachEvent("click",this.functions.Multiple),c.attachEvent("click",this.functions.preventDefault)):"select"===d||"textarea"===d||"input"===d&&e.indexOf(c.type.toLowerCase())>-1?c.addEventListener?(c.addEventListener("change",this.functions.Multiple,!1),this.unbinders.push({element:c,action:"change",fn:this.functions.Multiple})):c.attachEvent("change",this.functions.Multiple):c.addEventListener?(c.addEventListener("click",this.functions.Multiple,!1),this.unbinders.push({element:c,action:"click",fn:this.functions.Multiple})):c.attachEvent("click",this.functions.Multiple),a[b].parentNode.replaceChild(c,a[b])}},uninstall:function(){this.unbinders.forEach(function(a){a.element.removeEventListener(a.action,a.fn)})},Checkout:function(){var a=j.findValue("session");a.length<10?i.checkout():i.checkout(a)},Promo:function(){var a=j.findValue("promocode");i.promo(a)},Update:function(a){var b,c,d,e,f=a.getAttribute("data-fsc-item-path-value"),g=a.getAttribute("data-fsc-item-quantity-value"),h=a.getAttribute("data-fsc-quantity-src");if("input"!==a.tagName.toLowerCase()||"checkbox"!==a.type.toLowerCase()||a.checked){if(null!==g&&g>0)b=g;else if(null!==h&&h.length>0){if(c=document.getElementById(h),d=c.getAttribute("data-fsc-item-quantity-value"),null!==c)switch(e=c.tagName.toLowerCase(),!0){case"input"===e&&"checkbox"!==c.type.toLowerCase()||"select"===e:b=c.value;break;case"input"===e&&"checkbox"===c.type.toLowerCase()&&!c.checked:b=0;break;case"input"===e&&"checkbox"===c.type.toLowerCase()&&c.checked:b=1;break;case"null"!==d&&d>0:b=d;break;default:b=j.findValue("item-quantity",f)}}else b=a.hasOwnProperty("selectedIndex")&&a[a.selectedIndex].value>-1?a[a.selectedIndex].value:j.findValue("item-quantity",f);b=b||1}else b=0;i.update(f,b)},Add:function(a){var b=a.getAttribute("data-fsc-item-path-value");i.add(b)},Remove:function(a){var b=a.getAttribute("data-fsc-item-path-value");i.update(b,0)},Replace:function(a){var b=a.getAttribute("data-fsc-driver-item-path-value");i.update(b,0)},Recognize:function(){var a=j.findValue("firstname"),b=j.findValue("lastname"),c=j.findValue("email");i.recognize(c,a,b)},Reset:function(a){i.reset()},Clean:function(){i.clean()},Multiple:function(a){var b=this.functions;n=!0;var c=a.getAttribute("data-fsc-action");c.indexOf(",")>-1?c.split(",").forEach(function(c){c=c.trim(),b.hasOwnProperty(c)&&b[c](a)}):(c=c.trim(),b.hasOwnProperty(c)&&b[c](a)),n=!1,g.parseInput(l)},findValue:function(a,b){var c,d;if(c=b?document.querySelectorAll("[data-fsc-"+a+"-value][data-fsc-item-path-value='"+b+"']"):document.querySelectorAll("[data-fsc-"+a+"-value]"),void 0!==c[0]){if(d=c[0],d.value)return d.value;if(d.innerHTML)return d.innerHTML}return""},parseAndPut:function(a){p=!1===a.selections;var c=this.parseProducts(a),d=this.parseProductsDyna(a),e=this.parseDynaOrderLevel(a);this.processDynaOrderLists(d,c,e),c.length>0?(b("Products:",c),this.processProducts(c)):b("No products found in response");var f=this.parseOrderLevel(a);!1!==f?(b("Top level items:",f),this.processOrderLevelItems(f)):b("No top level items found in response"),this.addEventHandlers()},parseProducts:function(a){for(var b=[],c=0;c<a.groups.length;c++)b=b.concat(a.groups[c]);return j.myArray=b,b.length>0&&b},parseProductsDyna:function(a){var b={storefront:"storefront",offers:"offers"},c=function(a){this.raw=a.raw,this.setListType(this.raw.driver)};c.prototype.setListType=function(a){void 0===a?this.listType=b.storefront:a===j.listDriver||a.indexOf(j.listDriver)>-1?this.listType=b.storefront:a!==j.listDriver&&(this.listType=b.offers)},c.prototype.isStorefront=function(){return this.listType===b.storefront},c.prototype.isOffer=function(){return this.listType===b.offers};var d=a.groups.filter(function(a){return new c({raw:a}).isStorefront()}),e=a.groups.filter(function(a){return new c({raw:a}).isOffer()});return d=d.concat(e),d.length>0&&d},applyDynaFilter:function(a,b){var c,d,e,f={},g=[];return null!==b.filterList&&(b.filterList.split(";").forEach(function(a,b){d=a.split("="),f[d[0]]=d[1]}),g=a.filter(function(a){c=!0;for(var b in f)if(f.hasOwnProperty(b)){if(void 0===f[b]||null===f[b])return!0;if(e=f[b],"true"===f[b]&&(e=!0),"false"===f[b]&&(e=!1),"'"===f[b][0]){var d=f[b].length;e=f[b].substring(1,d-1)}else void 0!==window[e]&&(e=window[e]);if(a[b]!==e){c=!1;break}}return c})),g},parseOrderLevel:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&"groups"!==c&&(b=b.concat({key:c,value:a[c]}));return b.length>0&&b},processOrderLevelItems:function(a){var c=this;Array.isArray(a)?a.forEach(function(a){c.processOrderLevelItem(a.key,a.value)}):b("Unexpected format of data")},processOrderLevelItem:function(a,c){var d,e=this;if("selections"===a){var f=document.querySelectorAll("[data-fsc-selections-smartselect],[data-fsc-selections-smartdisplay],[data-fsc-selections-smartdisplay-inverse], [data-fsc-selections-hideifselections],[data-fsc-selections-showifselections],[data-fsc-selections-hideifnoselections],[data-fsc-selections-showifnoselections],[data-fsc-selections-smartdisable],[data-fsc-selections-smartdisable-inverse],[data-fsc-selections-disableifselections],[data-fsc-selections-disableifnoselectios],[data-fsc-selections-enableifselections],[data-fsc-selections-enableifnoselections]");if(null!==f)for(d=0;d<f.length;d++){var g=f[d];!g.hasAttribute("data-fsc-selections-smartselect")||"INPUT"!==g.tagName||"checkbox"!==g.type.toLowerCase()&&"radio"!==g.type.toLowerCase()||(g.checked=!0===c),g.hasAttribute("data-fsc-selections-smartdisplay")&&(g.style.display=!0===c?"block":"none"),g.hasAttribute("data-fsc-selections-smartdisplay-inverse")&&(g.style.display=!0===c?"none":"block"),g.hasAttribute("data-fsc-selections-hideifselections")&&!0===c&&(g.style.display="none"),g.hasAttribute("data-fsc-selections-showifselections")&&!0===c&&(g.style.display="block"),g.hasAttribute("data-fsc-selections-hideifnoselections")&&!1===c&&(g.style.display="none"),g.hasAttribute("data-fsc-selections-showifnoselections")&&!1===c&&(g.style.display="block"),g.hasAttribute("data-fsc-selections-smartdisable")&&(!1===c?g.setAttribute("disabled","disabled"):g.removeAttribute("disabled")),g.hasAttribute("data-fsc-selections-smartdisable-inverse")&&(!0===c?g.setAttribute("disabled","disabled"):g.removeAttribute("disabled")),g.hasAttribute("data-fsc-selections-disableifselections")&&!0===c&&g.setAttribute("disabled","disabled"),g.hasAttribute("data-fsc-selections-disableifnoselectios")&&!1===c&&g.setAttribute("disabled","disabled"),g.hasAttribute("data-fsc-selections-enableifselections")&&!0===c&&g.removeAttribute("disabled"),g.hasAttribute("data-fsc-selections-enableifnoselections")&&!1===c&&g.removeAttribute("disabled")}}if("selections"===a&&!1===c){var h=document.querySelectorAll("[data-fsc-checkout-hideempty]");if(null!==h)for(d=0;d<h.length;d++)"a"===h[d].tagName.toLowerCase()?h[d].setAttribute("style","display: none"):"div"===h[d].tagName.toLowerCase()?h[d].setAttribute("style","display: none"):h[d].setAttribute("disabled","disabled")}if("selections"===a&&!0===c){var i=document.querySelectorAll("[data-fsc-checkout-hideempty]");if(null!==i)for(d=0;d<i.length;d++)"a"===i[d].tagName.toLowerCase()?i[d].setAttribute("style","display: inline"):"div"===i[d].tagName.toLowerCase()?i[d].setAttribute("style","display: block"):i[d].removeAttribute("disabled")}a=this.mapProperty(a),c=this.mapValue(a,c),b("Processing top order level item:",a,c);var j="[data-fsc-order-"+a+"]",k=document.querySelectorAll(j);for(d=0;d<k.length;d++)e.processPropToElem(a,c,k[d],"data-fsc-order-"+a)},mapProperty:function(a){var b={};return b.coupons="promocode",b["description-action"]="calltoaction",b.hasOwnProperty(a)&&(a=b[a]),a},mapValue:function(a,b){return"promocode"===a&&(b=b[0]||""),b},parseDynaOrderLevel:function(a){var b=[];return b.push(a),b.length>0&&b},processDynaOrderLists:function(a,c,d){var e=this;if(Array.isArray(a)){for(var f=a.length,g=0;g<f;g++)a[g].items.forEach(function(a){void 0!==a.future&&e.futureAddProps(a)});var h=this.dynaListObjs.length,i={};for(g=0;g<h;g++){for(var j=0;j<f;j++)null!==this.dynaListObjs[g].filterList&&(i[j]=Object.create(a[j]),i[j].items=this.applyDynaFilter(i[j].items,this.dynaListObjs[g]));this.displayDynaOrderLists({items:i,groups:c,order:d},this.handlebarTemplates[g],this.dynaListObjs[g].containerName)}}else b("not an array of products so cannot markup")},processProducts:function(a){function c(a){var b=a.path;void 0!==a.future&&d.futureAddProps(a),d.processProduct(a,b)}var d=this;if(Array.isArray(a))for(var e=a.length,f=0;f<e;f++)a[f].items.forEach(function(a){c(a)});else b("not an array of products so cannot markup")},futureAddProps:function(a){var b,c,d;void 0!==a.future.beginsValue?(b=new Date(a.future.beginsValue),c=new Date(a.future.beginsValue)):(b=new Date,c=new Date),d=b.toLocaleDateString(),
    "week"===a.future.intervalUnit&&c.setDate(c.getDate()+a.future.discountDurationLength*a.future.intervalLength*7),"month"===a.future.intervalUnit&&c.setMonth(c.getMonth()+a.future.discountDurationLength*a.future.intervalLength),"year"===a.future.intervalUnit&&c.setFullYear(c.getFullYear()+a.future.discountDurationLength*a.future.intervalLength),c.getDate(),c.getMonth(),c.getFullYear(),String(c).split(" ")[1],a.future.ends=c.toLocaleDateString(),a.future.endsValue=c,a.future.beginsDate=d},processProduct:function(a,c){var d,e,f="";f=a.priceTotalValue===a.totalValue?"hide":"show";var h=document.querySelectorAll("[data-fsc-item-path='"+c+"']");if(null!==h){for(d=0;d<h.length;d++){var i=h[d];!i.hasAttribute("data-fsc-item-selection-smartselect")||"INPUT"!==i.tagName||"checkbox"!==i.type.toLowerCase()&&"radio"!==i.type.toLowerCase()||(a.selected?i.checked=!0:i.checked=!1),i.hasAttribute("data-fsc-item-selection-smartdisplay")&&(a.selected?i.style.display="block":i.style.display="none"),i.hasAttribute("data-fsc-item-selection-smartdisplay-inverse")&&(a.selected?i.style.display="none":i.style.display="block"),i.hasAttribute("data-fsc-item-hideifselected")&&a.selected&&(i.style.display="none"),i.hasAttribute("data-fsc-item-showifselected")&&a.selected&&(i.style.display="block"),i.hasAttribute("data-fsc-item-hideifnotselected")&&(a.selected||(i.style.display="none")),i.hasAttribute("data-fsc-item-showifnotselected")&&(a.selected||(i.style.display="block")),i.hasAttribute("data-fsc-item-smartdisable")&&(a.selected?i.removeAttribute("disabled"):i.setAttribute("disabled","disabled")),i.hasAttribute("data-fsc-item-smartdisable-inverse")&&(a.selected?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled")),i.hasAttribute("data-fsc-item-disableifselected")&&a.selected&&i.setAttribute("disabled","disabled"),i.hasAttribute("data-fsc-item-disableifnotselected")&&(a.selected||i.setAttribute("disabled","disabled")),i.hasAttribute("data-fsc-item-enableifselected")&&a.selected&&i.removeAttribute("disabled"),i.hasAttribute("data-fsc-item-enableifnotselected")&&(a.selected||i.removeAttribute("disabled"))}a.link="https://"+g.storefront+"/"+c;for(var k in a)if(a.hasOwnProperty(k)){var l=k;if("string"==typeof k&&(l=k.replace(/\./g,"\\.")),"object"==typeof a[k]&&"path"!==k){for(var m in a[k])if(a[k].hasOwnProperty(m)){var n=m;for("string"==typeof m&&(n=m.replace(/\./g,"\\.")),e=document.querySelectorAll("[data-fsc-item-path='"+c+"'][data-fsc-item-"+l+"-"+n+"]"),d=0;d<e.length;d++)j.processPropToElem(m,a[k][m],e[d],"data-fsc-item-"+k+"-"+m,f)}}else if("path"!==k)for(e=document.querySelectorAll("[data-fsc-item-path='"+c+"'][data-fsc-item-"+l+"]"),d=0;d<e.length;d++)j.processPropToElem(k,a[k],e[d],"data-fsc-item-"+k,f);else if("path"===k)for(e=document.querySelectorAll("[data-fsc-item-path='"+c+"'][data-fsc-item-"+l+"-element]"),d=0;d<e.length;d++)j.processPropToElem(k,a[k],e[d],"data-fsc-item-"+k,f)}}else b("no markup to markup for the product-path and/or no productData property exist")},processPropToElem:function(a,c,d,e,f){b("Processing values for a single element:",a,d,f),null!==c&&(c=c.toString().replace("<p>",""),c=c.replace("</p>","")),c=c.toString().replace("<p>",""),c=c.replace("</p>",""),e=e.toLowerCase();var g=d.tagName.toLowerCase();"a"===g?"data-fsc-item-link"===e?(b("Setting href to",c,d),d.setAttribute("href",c)):d.innerHTML=c.toString():"input"===g?(b("Setting value to",c,d),d.value=c):"select"===g?d[c-1]&&d[c-1].setAttribute("selected",!0):"button"===g?(b("Setting value to",c,d),d.value=c):"img"===g?(b("Setting src to",c,d),d.setAttribute("src",c)):"div"===g||(a.indexOf("Value")>-1?(d.value="",d.setAttribute("data-fsc-item-"+a,c),d.innerHTML=c.toString()):d.innerHTML=c.toString());var h,i=["data-fsc-item-price","data-fsc-item-pricetotal"];b("do I run SmartDisplay for",a,f),void 0!==d.getAttribute("data-fsc-smartdisplay")&&null!==d.getAttribute("data-fsc-smartdisplay")&&i.indexOf(e)>-1&&(b("Agreed to run SmartDisplay for",a,f),null!==(h=""===d.getAttribute("data-fsc-smartdisplay")?d:document.querySelector("["+d.getAttribute("data-fsc-smartdisplay")+"]"))&&(f&&"show"===f?h.setAttribute("style","display: block"):h.setAttribute("style","display: none"))),d.hasAttribute("data-fsc-callback")&&"function"==typeof window[d.getAttribute("data-fsc-callback")]&&(b("Agreed to run CallBack function for",a,d.getAttribute("data-fsc-callback")),window[d.setAttribute("data-fsc-callback")](d,a,c))},displayDynaOrderLists:function(a,b,c){var d=document.querySelector("[data-fsc-items-container='"+c+"']");if(void 0!==b){var e=b(a);d.innerHTML=e}}};j.ready=!1,j.data=null;var k=document.querySelector("script#fsc-api"),l=window.fscSession||{},m=!1,n=!1,o=!1,p=!1;document.addEventListener("DOMContentLoaded",function(){j.init(),j.process()},!1),g.init();var q={};Object.defineProperty(q,"builder",{enumerable:!0,configurable:!0,get:function(){return i}}),Object.defineProperty(window,"fastspring",{enumerable:!0,configurable:!0,get:function(){return q}}),Object.defineProperty(window,"_f",{configurable:!0,get:function(){return console.log("Warning: '_f' is deprecated, please use 'fastspring.builder' instead"),i}})}();